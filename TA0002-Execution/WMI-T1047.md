## ‚öôÔ∏è T1047 - Windows Management Instrumentation (WMI)

**MITRE Tactic:** Execution (TA0002)

### üìù Description

**Windows Management Instrumentation (WMI)** is a powerful built-in utility used by administrators for system management, configuration, and task automation. Adversaries leverage WMI (via `wmic.exe` or `powershell.exe` cmdlets) to execute malicious code on local or remote systems.  This technique is highly favored because it is **"living off the land,"** making malicious activity blend in with normal administrative tasks and often bypassing traditional signature-based security products.

In the context of Microsoft Defender XDR, detecting WMI abuse requires deep analysis of process command lines and associated file events, specifically looking for unusual or malicious parameters passed to the WMI process or related providers.

This section focuses on KQL queries designed to detect the **abnormal execution and behavior** of WMI, such as:

* **Remote Execution:** Identifying remote execution attempts via WMI, often targeting the `Win32_Process` class to create a new process on a remote machine (`DeviceProcessEvents`).
* **WMI Persistence:** Detecting the creation or modification of permanent WMI event subscriptions, a stealthy method for establishing persistence (`DeviceRegistryEvents` or WMI event logs).
* **Suspicious Payload Delivery:** Monitoring WMI command lines for encoding, base64 payloads, or execution of suspicious network utility commands (like `certutil` or `bitsadmin`).

### üìÅ Sub-Techniques Covered

| Sub-Technique ID | Name | Focus |
| :--- | :--- | :--- |
| **T1047** | Windows Management Instrumentation | Focuses on command-line parameters and process execution patterns that deviate from normal administrative use of WMI. |

#### Queries

**1. Detect Office products launching wmic.exe:**

Detection of WMIC execution from Office products:

```
‚Äã‚Äã// Office products spawning WMI
DeviceProcessEvents
| where InitiatingProcessFileName in~ ("winword.exe", "excel.exe", "outlook.exe")
and FileName =~"wmic.exe"
```